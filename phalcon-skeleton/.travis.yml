language: php

php:
  - 5.4
  - 5.5
  - 5.6
  
cache: 
  - apt

addons:
  hosts:
    - phalcon-module.local

env:
  - PHALCON_VERSION="2.0.0"
  - PHALCON_VERSION="2.0.8"
  - PHALCON_VERSION="2.0.9"

before_script:
  - ./tests/ci/install-php-extension.sh ${PHALCON_VERSION}
  - php -r 'echo \Phalcon\Version::get()."\n";'
  - ./tests/ci/install-fpm-nginx.sh
  - cp application/config/parameters.php.dist application/config/parameters.php

install:
 - composer --prefer-dist install
 - mysql -uroot -e 'create database `phalcon-module-skeleton` charset=utf8 collate=utf8_unicode_ci;'
 - mysql -uroot phalcon-module-skeleton < ./scheme/dump.sql

script:
 - curl http://phalcon-module.local/
 - vendor/bin/phpcs --standard=PSR2 --report=emacs --extensions=php --warning-severity=0 application/ library/ public/
 - php public/index.php

after_failure:
  - sudo apt-get -qq install gdb
  - ./tests/ci/after_failure.sh
